################################################################
################################################################
################################################################

ARG DEBIAN_VERSION=bookworm

################################################################

ARG NODE_VERSION=hydrogen
ARG NODE_CONTAINER_TAG=${NODE_VERSION}-${DEBIAN_VERSION}-slim

################################################################
################################################################
################################################################

FROM node:${NODE_CONTAINER_TAG} as builder

################################################################

USER root
RUN npm i -g npm
RUN npm i -g yarn --force

################################################################

WORKDIR /srv

################################################################

RUN chown -R node:node /srv/ && \
    chmod 0750 /srv/

COPY --chown=node:node package.json yarn.lock /srv/
RUN chmod 0640 /srv/package.json /srv/yarn.lock

################################################################

USER node
RUN yarn install --frozen-lockfile

################################################################

COPY --chown=node:node . /srv
RUN yarn build

################################################################
################################################################
################################################################

FROM nginx:stable-alpine3.17

################################################################

COPY --chown=root:root --from=builder /srv/dist /usr/share/nginx/html

################################################################

EXPOSE 80/tcp

################################################################

CMD nginx -g 'daemon off;'

################################################################
################################################################
################################################################
